<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MikroTik Realtime Monitor</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* ================= ROOT ================= */
:root{
    --primary:#2a5bd7;
    --primary-dark:#1e4ac4;
    --success:#00c9a7;
    --warning:#ffa502;
    --danger:#ff4757;
    --bg:#f5f7fb;
    --card:#fff;
    --shadow:rgba(42,91,215,.1);
}

*{margin:0;padding:0;box-sizing:border-box}

body{
    font-family:'Segoe UI',system-ui,sans-serif;
    background:var(--bg);
    padding:12px;
    color:#333;
}

/* ================= LAYOUT ================= */
.container{max-width:480px;margin:auto}

.header{
    background:linear-gradient(135deg,var(--primary),var(--primary-dark));
    color:#fff;
    padding:16px;
    border-radius:6px;
    margin-bottom:14px;
}

.header h1{font-size:1.3rem}

.status-indicator{
    font-size:.8rem;
    margin-top:6px;
}

.status-dot{
    width:8px;height:8px;
    border-radius:50%;
    background:#2ed573;
    display:inline-block;
    animation:pulse 2s infinite;
}

.content{display:flex;flex-direction:column;gap:14px}

/* ================= TRAFFIC ================= */
.traffic-section{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:12px;
}

.traffic-card{
    background:var(--card);
    border-radius:6px;
    padding:12px;
    box-shadow:0 6px 14px var(--shadow);
    text-align:center;
}

/* ================= SPEEDOMETER ================= */
.speedometer-container{
    position:relative;
    width:120px;
    height:120px;
    margin:auto;
}

.speedometer-svg{width:100%;height:100%}

.speedometer-track{
    fill:none;
    stroke:#e9ecef;
    stroke-width:7;
}

.speedometer-arc{
    fill:none;
    stroke-width:7;
    stroke-linecap:round;
    stroke-dasharray:157;
    stroke-dashoffset:157;
    transition:stroke-dashoffset .7s ease,stroke .4s ease;
}

/* COLOR STATE */
.speed-low{stroke:var(--success)}
.speed-medium{stroke:var(--warning)}
.speed-high{stroke:var(--danger)}

/* NEEDLE */
.needle-container{
    position:absolute;
    inset:0;
    transition:transform .6s cubic-bezier(.34,1.56,.64,1);
}

.needle{
    position:absolute;
    width:3px;
    height:48px;
    background:#333;
    top:50%;
    left:50%;
    transform-origin:bottom center;
    transform:translate(-50%,-100%);
    border-radius:3px;
}

.needle::after{
    content:'';
    width:12px;height:12px;
    background:#333;
    border-radius:50%;
    position:absolute;
    bottom:-6px;
    left:50%;
    transform:translateX(-50%);
}

/* VALUE */
.speedometer-center{
    position:absolute;
    inset:0;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
}

.speedometer-value{
    font-size:1.35rem;
    font-weight:800;
    line-height:1;
}

.speedometer-unit{
    font-size:.7rem;
    color:#666;
    margin-top:2px;
}

/* FOOTER */
.footer{
    margin-top:14px;
    text-align:center;
    font-size:.75rem;
    color:#666;
}

@keyframes pulse{
    0%,100%{opacity:1}
    50%{opacity:.5}
}
/* ================= SYSTEM MONITOR (VERTIKAL) ================= */
.system-section{
    display:flex;
    flex-direction:column;
    gap:12px;
}

.system-card{
    background:var(--card);
    border-radius:6px;
    padding:12px;
    box-shadow:0 6px 14px var(--shadow);
}

.system-title{
    font-size:.75rem;
    color:#666;
    margin-bottom:6px;
}

.system-value{
    font-size:1.1rem;
    font-weight:700;
    margin-bottom:6px;
}

.progress-bar{
    height:8px;
    background:#e9ecef;
    border-radius:6px;
    overflow:hidden;
}

.progress-fill{
    height:100%;
    width:0%;
    background:var(--success);
    transition:width .6s ease,background .4s ease;
}

.progress-warning{background:var(--warning)}
.progress-danger{background:var(--danger)}

.system-wide{
    grid-column:1 / -1;
    text-align:center;
    font-size:.8rem;
    color:#555;
}
/* ================= TRAFFIC LABEL ================= */
.traffic-label{
    margin-top:6px;
    font-size:.75rem;
    font-weight:600;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:6px;
    letter-spacing:.3px;
}

.traffic-label i{
    font-size:.85rem;
}

/* WARNA PROFESIONAL */
.traffic-label.download{
    color:var(--success);
}

.traffic-label.upload{
    color:var(--success);
}

</style>
</head>

<body>
<div class="container">

<header class="header">
    <h1><i class="fas fa-satellite-dish"></i> SERVER TEGUHAN</h1>
    <div class="status-indicator">
        <span class="status-dot"></span> Sistem Aktif â€¢ Realtime
    </div>
</header>

<main class="content">
    <section class="traffic-section">

        <!-- RX / DOWNLOAD -->
        <div class="traffic-card">
            <div class="speedometer-container">
                <svg class="speedometer-svg" viewBox="0 0 160 160">
                    <path class="speedometer-track" d="M30,80 A50,50 0 1 1 130,80"/>
                    <path id="rxArc" class="speedometer-arc speed-low"
                          d="M30,80 A50,50 0 1 1 130,80"/>
                </svg>
                <div class="needle-container" id="rxNeedle">
                    <div class="needle"></div>
                </div>
                <div class="speedometer-center">
                    <div class="speedometer-value" id="rxValue">0</div>
                    <div class="speedometer-unit">Mbps</div>
                </div>
            </div>
        
            <!-- LABEL DOWNLOAD -->
            <div class="traffic-label download">
                <i class="fas fa-arrow-down"></i> Download
            </div>
        </div>
        
        <!-- TX / UPLOAD -->
        <div class="traffic-card">
            <div class="speedometer-container">
                <svg class="speedometer-svg" viewBox="0 0 160 160">
                    <path class="speedometer-track" d="M30,80 A50,50 0 1 1 130,80"/>
                    <path id="txArc" class="speedometer-arc speed-low"
                          d="M30,80 A50,50 0 1 1 130,80"/>
                </svg>
                <div class="needle-container" id="txNeedle">
                    <div class="needle"></div>
                </div>
                <div class="speedometer-center">
                    <div class="speedometer-value" id="txValue">0</div>
                    <div class="speedometer-unit">Mbps</div>
                </div>
            </div>
        
            <!-- LABEL UPLOAD -->
            <div class="traffic-label upload">
                <i class="fas fa-arrow-up"></i> Upload
            </div>
        </div>
        
        </section>
        
</main>
<br>
<section class="system-section">

    <!-- CPU -->
    <div class="system-card">
        <div class="system-title">CPU Usage</div>
        <div class="system-value"><span id="cpuVal">0</span>%</div>
        <div class="progress-bar">
            <div class="progress-fill" id="cpuBar"></div>
        </div>
    </div>
    
    <!-- RAM -->
    <div class="system-card">
        <div class="system-title">RAM Usage</div>
        <div class="system-value">
            <span id="ramUsed">0</span> / <span id="ramTotal">0</span> MB
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="ramBar"></div>
        </div>
    </div>
    
    <!-- DISK -->
    <div class="system-card">
        <div class="system-title">Disk Usage</div>
        <div class="system-value">
            <span id="diskUsed">0</span> / <span id="diskTotal">0</span> GB
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="diskBar"></div>
        </div>
    </div>
    
    <!-- UPTIME -->
    <div class="system-card">
        <div class="system-title">Uptime</div>
        <div class="system-value" id="uptimeVal">-</div>
    </div>
    
    </section>
    
<!-- <footer class="footer">
MikroTik Realtime Monitor â€¢ Python Backend
</footer> -->

</div>

<script>
    const API = "http://192.168.30.50:8000/api/status";
    const MAX_MBPS = 100; // ðŸ”’ FIX 100 Mbps
    
    /* =======================
       SPEEDOMETER (JANGAN DIUBAH)
    ======================= */
    function updateNeedle(id,value){
        const v = Math.min(parseFloat(value), MAX_MBPS);
        const percent = v / MAX_MBPS;
        const angle = -90 + (percent * 180);
    
        const needle = document.getElementById(id);
        const arc = document.getElementById(id === "rxNeedle" ? "rxArc" : "txArc");
        const val = document.getElementById(id === "rxNeedle" ? "rxValue" : "txValue");
    
        needle.style.transform = `rotate(${angle}deg)`;
    
        const arcLen = 157;
        arc.style.strokeDashoffset = arcLen - (arcLen * percent);
    
        arc.className = "speedometer-arc " +
            (percent < 0.4 ? "speed-low" :
             percent < 0.75 ? "speed-medium" : "speed-high");
    
        val.style.color =
            percent < 0.4 ? "#00c9a7" :
            percent < 0.75 ? "#ffa502" : "#ff4757";
    
        val.textContent = v.toFixed(2);
    }
    
    /* =======================
       SYSTEM MONITOR (REVISI FIX)
    ======================= */
    function updateSystem(sys){
        if(!sys) return;
    
        /* CPU */
        const cpu = sys.cpu || 0;
        document.getElementById("cpuVal").textContent = cpu;
        const cpuBar = document.getElementById("cpuBar");
        cpuBar.style.width = cpu + "%";
        cpuBar.className =
            "progress-fill " +
            (cpu < 50 ? "" : cpu < 80 ? "progress-warning" : "progress-danger");
    
        /* RAM */
        const ramUsed = sys.ram_used || 0;
        const ramTotal = sys.ram_total || 1;
        const ramPercent = (ramUsed / ramTotal) * 100;
    
        document.getElementById("ramUsed").textContent = ramUsed;
        document.getElementById("ramTotal").textContent = ramTotal;
    
        const ramBar = document.getElementById("ramBar");
        ramBar.style.width = ramPercent + "%";
        ramBar.className =
            "progress-fill " +
            (ramPercent < 50 ? "" : ramPercent < 80 ? "progress-warning" : "progress-danger");
    
        /* DISK */
        const diskUsed = sys.disk_used || 0;
        const diskTotal = sys.disk_total || 1;
        const diskPercent = (diskUsed / diskTotal) * 100;
    
        document.getElementById("diskUsed").textContent = diskUsed;
        document.getElementById("diskTotal").textContent = diskTotal;
    
        const diskBar = document.getElementById("diskBar");
        diskBar.style.width = diskPercent + "%";
        diskBar.className =
            "progress-fill " +
            (diskPercent < 50 ? "" : diskPercent < 80 ? "progress-warning" : "progress-danger");
    
        /* UPTIME */
        document.getElementById("uptimeVal").textContent = sys.uptime || "-";
    }
    
    /* =======================
       FETCH DATA
    ======================= */
    async function loadData(){
        try{
            const r = await fetch(API);
            const d = await r.json();
    
            /* Speedometer */
            if(d.traffic){
                updateNeedle("rxNeedle", d.traffic.rx_bps / 1e6);
                updateNeedle("txNeedle", d.traffic.tx_bps / 1e6);
            }
    
            /* System */
            if(d.system){
                updateSystem(d.system);
            }
    
        }catch(e){
            console.error("API Error:", e);
        }
    }
    
    /* =======================
       CLOCK
    ======================= */
    function clock(){
        document.getElementById("datetime").textContent =
            new Date().toLocaleString("id-ID",{
                weekday:"long",
                hour:"2-digit",
                minute:"2-digit",
                second:"2-digit"
            });
    }
    
    /* =======================
       LOOP
    ======================= */
    setInterval(loadData, 1000);
    setInterval(clock, 1000);
    clock();
    loadData();
</script>
</body>
</html>
